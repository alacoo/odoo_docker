version: '3.7'
services:
  odoo:
     build: .  # <-- Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„. Ø³ÙŠØ®Ø¨Ø± Coolify Ø£Ù† ÙŠØ¨Ø­Ø« Ø¹Ù† Dockerfile
    restart: unless-stopped
    environment:
      - SERVICE_URL_ODOO_8069
      - HOST=postgresql
      - USER=$SERVICE_USER_POSTGRES
      - PASSWORD=$SERVICE_PASSWORD_POSTGRES
      - ODOO_CORS_ORIGINS=*
      - ODOO_SERVER_WIDE_MODULES=base,web,rest_api_addon
      - ODOO_PROXY_MODE=True
      - ODOO_HTTP_ENABLE=True
      - ODOO_RC=/etc/odoo/odoo.conf   
      # ðŸ”§ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯ÙŠØ¨Ø§Ø¬ Ù…Ù† Ø®Ù„Ø§Ù„ environment variables
      - ODOO_DEBUG=True
      - ODOO_DEV_MODE=True
      - ODOO_DEBUG_MODE=True
      
      # ðŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
      - ODOO_LOG_LEVEL=debug
      - ODOO_LOG_HANDLER=:DEBUG
      - ODOO_LOG_DB=True
      - ODOO_LOG_DB_LEVEL=debug
      - ODOO_LOGFILE=/var/log/odoo/odoo.log
      - ODOO_LOGROTATE=True
      - ODOO_LOGROTATE_SIZE=134217728
      - ODOO_LOGROTATE_COUNT=7
      
      # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¯ÙŠØ¨Ø§Ø¬
      - ODOO_PROXY_MODE=True
      - ODOO_HTTP_ENABLE=True
      - ODOO_CORS_ORIGINS=*
      - ODOO_SERVER_WIDE_MODULES=base,web,rest_api_addon
    volumes:
      - 'odoo-web-data:/var/lib/odoo'
      - '/opt/odoo-addons-final:/mnt/extra-addons'
      - '/opt/odoo/config:/etc/odoo'  # Ø³ÙŠØ±Ø¨Ø· Ù…Ø¬Ù„Ø¯ config
      - '/opt/odoo/logs:/var/log/odoo'
    healthcheck:
      test:
        - CMD
        - curl
        - '-f'
        - 'http://127.0.0.1:8069'
      interval: 2s
      timeout: 10s
      retries: 30
  postgresql:
    image: 'postgres:16-alpine'
    restart: unless-stopped
    volumes:
      - 'postgresql-data:/var/lib/postgresql/data'
    environment:
      - POSTGRES_USER=$SERVICE_USER_POSTGRES
      - POSTGRES_PASSWORD=$SERVICE_PASSWORD_POSTGRES
      - POSTGRES_DB=postgres
healthcheck:
      test:
        - CMD-SHELL
        - 'pg_isready -U $${POSTGRES_USER} -d postgres'
      interval: 5s
      timeout: 20s
      retries: 10

volumes:
  odoo-web-data:
  postgresql-data:
